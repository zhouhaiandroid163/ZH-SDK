<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SdkLog</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Prism.jsç”¨äºJSONè¯­æ³•é«˜äº® -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>

  <!-- å¼•å…¥Font Awesomeç”¨äºå›¾æ ‡ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">

  <!-- é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            success: '#00B42A',
            warning: '#FF7D00',
            danger: '#F53F3F',
            info: '#86909C',
            dark: {
              100: '#F2F3F5',
              200: '#E5E6EB',
              300: '#C9CDD4',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
              800: '#0A0C10',
            }
          },
          fontFamily: {
            mono: ['Consolas', 'Monaco', 'monospace'],
          },
        },
      }
    }
  </script>

  <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
  <style type="text/tailwindcss">
    @layer utilities {
        .log-row-hover {
          @apply hover:bg-dark-600/50 transition-colors duration-150;
        }
        .log-type-pill {
          @apply text-xs px-2 py-0.5 rounded-full font-medium;
        }
        .log-data-container {
          @apply overflow-hidden transition-all duration-300 ease-in-out;
        }
        .log-row-active {
          @apply bg-dark-600/40 border-l-4 border-primary shadow-[inset_0_0_1px_rgba(22,93,255,0.3)];
        }
        .resizer {
          @apply w-1 bg-dark-600 hover:bg-primary cursor-col-resize transition-colors relative;
        }
        .resizer::before {
          content: '';
          @apply absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-dark-500;
        }
        .json-toggle {
          @apply cursor-pointer inline-flex items-center mr-2 
                text-orange-300 
                hover:text-orange-100 
                transition-colors duration-150;
        }
        .json-container {
          @apply mt-2 pl-4 border-l-2 border-dark-600 rounded-r-md bg-dark-700/50 overflow-hidden;
        }
        .json-line {
          @apply whitespace-pre-wrap;
        }
        .filter-dropdown {
          @apply absolute z-50 mt-1 w-64 bg-dark-700 border border-dark-500 rounded-md shadow-lg max-h-[60vh] flex flex-col;
        }
        .filter-items-wrapper {
          @apply flex-1 overflow-y-auto p-2 pt-3 pb-3;
        }
        .filter-all-item {
          @apply border-b border-dark-500 font-medium sticky top-0 bg-dark-700 z-20 py-2.5;
        }
        .filter-item {
          @apply px-4 py-2.5 text-sm hover:bg-primary/30 cursor-pointer flex items-center justify-between transition-colors;
        }
        .filter-checkbox {
          @apply w-4 h-4 rounded border-dark-400 bg-dark-600 text-primary focus:ring-primary/50;
        }
        .filter-footer {
          @apply border-t border-dark-500 p-2 flex justify-end gap-2 sticky bottom-0 bg-dark-700;
        }
        .filter-btn {
          @apply px-3 py-1 text-sm rounded-md transition-colors;
        }
        .filter-btn-disabled {
          @apply bg-dark-500 text-dark-400 cursor-not-allowed;
        }
        .filter-header-active {
          @apply bg-primary/80 shadow-[0_0_0_2px_rgba(22,93,255,0.5)];
        }
        .filter-cancel-btn {
          @apply bg-dark-500 hover:bg-dark-400;
        }
      }
    </style>

  <style>
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ - è°ƒçª„å®½åº¦ï¼ˆ8pxï¼‰å¹¶ä¼˜åŒ–å¯¹æ¯”åº¦ */
    ::-webkit-scrollbar {
      width: 8px;
      /* ğŸ”´ ä»20pxè°ƒçª„åˆ°8px */
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1D2129;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #6B7280;
      border-radius: 4px;
      border: 1px solid #1D2129;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #165DFF;
      border-color: #1D2129;
    }

    ::-webkit-scrollbar-button {
      background: #272E3B;
      border-radius: 2px;
    }

    ::-webkit-scrollbar-button:hover {
      background: #165DFF;
    }

    /* ç¡®ä¿é¡µé¢å æ»¡é«˜åº¦ */
    html,
    body {
      height: 100%;
      overflow: hidden;
    }

    /* æ‹–æ‹½ç›¸å…³æ ·å¼ */
    .main-container {
      display: flex;
      height: calc(100vh - 61px);
    }

    /* ç¡®ä¿ç­›é€‰æ§ä»¶å†…éƒ¨å…ƒç´ å·¦å¯¹é½ */
    .filter-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      transition: background-color 0.2s;
      position: relative;
      gap: 3px;
    }

    /* hoveræ•ˆæœä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰ */
    .filter-header:hover {
      background-color: rgba(22, 93, 255, 0.8);
    }

    /* æ–‡ä»¶é€‰æ‹©æŒ‰é’®æ ·å¼ */
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    /* ä»£ç å—æ ·å¼è°ƒæ•´ */
    pre[class*="language-"] {
      margin: 0;
      padding: 1em;
      border-radius: 0.3em;
      overflow-x: auto;
      background: transparent !important;
    }

    /* JSONæŠ˜å ç›¸å…³æ ·å¼ */
    .json-collapsible {
      max-height: 0;
      overflow: hidden;
    }

    .json-collapsible.expanded {
      max-height: 2000px;
    }

    /* Prism.js è‡ªå®šä¹‰é¢œè‰²é€‚é…æ·±è‰²ä¸»é¢˜ */
    .token.property {
      color: #a6e22e;
    }

    .token.string {
      color: #e6db74;
    }

    .token.number {
      color: #ae81ff;
    }

    .token.boolean {
      color: #ae81ff;
    }

    .token.null {
      color: #ae81ff;
    }

    .token.punctuation {
      color: #f8f8f2;
    }

    .token.brace {
      color: #f8f8f2;
    }

    /* ç­›é€‰ä¸‹æ‹‰èœå•éšè—/æ˜¾ç¤ºè¿‡æ¸¡ */
    .filter-dropdown {
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .filter-dropdown.show {
      display: flex;
      /* ğŸ”´ æ”¹ä¸ºflexæ˜¾ç¤º */
      opacity: 1;
      transform: translateY(0);
    }

    /* ç­›é€‰é€‰ä¸­çŠ¶æ€çš„è®¡æ•°æ ·å¼ */
    .filter-count {
      @apply bg-dark-600 text-dark-300 text-xs px-1.5 py-0.5 rounded-full;
    }

    /* ç­›é€‰æ¡ä»¶æ¿€æ´»çŠ¶æ€æç¤º */
    .filter-active-indicator {
      @apply absolute -top-1 -right-1 w-4 h-4 bg-primary rounded-full flex items-center justify-center text-[10px] font-bold;
    }

    /* ä¿®å¤ç­›é€‰èœå•æ»šåŠ¨æ—¶çš„è¾¹æ¡†é‡å é—®é¢˜ */
    .filter-items-wrapper::-webkit-scrollbar-track {
      margin-top: 2px;
      margin-bottom: 2px;
    }
  </style>
</head>

<body class="bg-dark-800 text-dark-100 font-mono">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="bg-dark-700 border-b border-dark-600 py-3 px-6 flex items-center justify-start shadow-md gap-4">
  <div class="flex items-center space-x-3">
      <h1 class="text-lg font-semibold">SdkLog_20251107_v1.1</h1>
    </div>

    <!-- Dateç­›é€‰ -->
    <div class="filter-header ml-0 bg-primary px-4 py-2 rounded-md cursor-pointer relative" id="date-filter-header">
      <span id="date-filter-text">Date</span>
      <span id="date-filter-active" class="filter-active-indicator hidden">â­</span>
    </div>

    <!-- Typeç­›é€‰ -->
    <div class="filter-header ml-0 bg-primary px-4 py-2 rounded-md cursor-pointer relative" id="type-filter-header">
      <span id="type-filter-text">Type</span>
      <span id="type-filter-active" class="filter-active-indicator hidden">â­</span>
    </div>

    <!-- Tagç­›é€‰ -->
    <div class="filter-header bg-primary px-4 py-2 rounded-md cursor-pointer relative" id="tag-filter-header">
      <span id="tag-filter-text">Tag</span>
      <span id="tag-filter-active" class="filter-active-indicator hidden">â­</span>
    </div>

    <!-- æ–‡ä»¶é€‰æ‹©æŒ‰é’® -->
    <div class="file-input-wrapper" style="margin-left: auto;">
      <button
        class="bg-primary hover:bg-primary/80 text-white text-sm px-3 py-1.5 rounded-md transition-colors flex items-center">
        <i class="fa fa-upload mr-2"></i>Select log file
      </button>
      <input type="file" id="fileInput" accept=".zh" />
    </div>
  </header>

  <!-- Dateç­›é€‰ä¸‹æ‹‰èœå• -->
  <div id="date-filter-dropdown" class="filter-dropdown">
    <div class="filter-items-wrapper" id="date-filter-items">
      <!-- å…¨é€‰æ¡†å’Œç­›é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="filter-footer">
      <button id="date-filter-apply" class="filter-btn bg-primary hover:bg-primary/80" disabled>ç¡®å®š</button>
      <button id="date-filter-cancel" class="filter-btn filter-cancel-btn">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- Typeç­›é€‰ä¸‹æ‹‰èœå• -->
  <div id="type-filter-dropdown" class="filter-dropdown">
    <div class="filter-items-wrapper" id="type-filter-items">
      <!-- å…¨é€‰æ¡†å’Œç­›é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="filter-footer">
      <button id="type-filter-apply" class="filter-btn bg-primary hover:bg-primary/80" disabled>ç¡®å®š</button>
      <button id="type-filter-cancel" class="filter-btn filter-cancel-btn">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- Tagç­›é€‰ä¸‹æ‹‰èœå• -->
  <div id="tag-filter-dropdown" class="filter-dropdown">
    <div class="filter-items-wrapper" id="tag-filter-items">
      <!-- å…¨é€‰æ¡†å’Œç­›é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="filter-footer">
      <button id="tag-filter-apply" class="filter-btn bg-primary hover:bg-primary/80" disabled>ç¡®å®š</button>
      <button id="tag-filter-cancel" class="filter-btn filter-cancel-btn">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒº -->
  <div class="main-container">
    <div id="log-container" class="flex-1 overflow-y-auto space-y-1 text-sm">
    </div>
  </div>

  <script>
    // å£°æ˜å…¨å±€å˜é‡
    let inputData = '';
    let logData = [];
    let filteredLogData = [];
    let dateFilterSelections = new Set();
    let typeFilterSelections = new Set();
    let tagFilterSelections = new Set();
    let tempDateSelections = new Set();
    let tempTypeSelections = new Set();
    let tempTagSelections = new Set();
    let allDates = new Set();
    let allTypes = new Set();
    let allTags = new Set();

    // DOMå…ƒç´ 
    const logContainer = document.getElementById('log-container');

    const fileInput = document.getElementById('fileInput');



    // Dateç­›é€‰ç›¸å…³å…ƒç´ 
    const dateFilterHeader = document.getElementById('date-filter-header');
    const dateFilterDropdown = document.getElementById('date-filter-dropdown');
    const dateFilterItems = document.getElementById('date-filter-items');
    const dateFilterApply = document.getElementById('date-filter-apply');
    const dateFilterActive = document.getElementById('date-filter-active');
    const dateFilterCancel = document.getElementById('date-filter-cancel');

    // Typeç­›é€‰ç›¸å…³å…ƒç´ 
    const typeFilterHeader = document.getElementById('type-filter-header');
    const typeFilterDropdown = document.getElementById('type-filter-dropdown');
    const typeFilterItems = document.getElementById('type-filter-items');
    const typeFilterApply = document.getElementById('type-filter-apply');
    const typeFilterActive = document.getElementById('type-filter-active');
    const typeFilterCancel = document.getElementById('type-filter-cancel');

    // Tagç­›é€‰ç›¸å…³å…ƒç´ 
    const tagFilterHeader = document.getElementById('tag-filter-header');
    const tagFilterDropdown = document.getElementById('tag-filter-dropdown');
    const tagFilterItems = document.getElementById('tag-filter-items');
    const tagFilterApply = document.getElementById('tag-filter-apply');
    const tagFilterActive = document.getElementById('tag-filter-active');
    const tagFilterCancel = document.getElementById('tag-filter-cancel');

    // åˆå§‹åŒ–æ–‡ä»¶é€‰æ‹©åŠŸèƒ½
    function initFileSelection() {
      fileInput.addEventListener('change', handleFileSelect);
      window.addEventListener('load', () => {
        setTimeout(() => {
          fileInput.click();
        }, 100);
      });
    }

    // åˆå§‹åŒ–Dateç­›é€‰åŠŸèƒ½
    function initDateFilter() {
      console.log("test001", "401")
      dateFilterHeader.addEventListener('click', (e) => {
        console.log("test001", "é¡¶éƒ¨æŒ‰é’®1")
        e.stopPropagation();
        closeTypeFilterDropdown();
        closeTagFilterDropdown();
        const isShow = dateFilterDropdown.classList.toggle('show');

        if (isShow) {
          console.log("test001", "æ˜¾ç¤º1")
          tempDateSelections = new Set(dateFilterSelections);
          renderDateFilterItems();
          updateDateFilterCounts();
          updateApplyButtonStatus('date');
          dateFilterDropdown.style.zIndex = 30;
          typeFilterDropdown.style.zIndex = 10;
          tagFilterDropdown.style.zIndex = 10;
        } else {
          console.log("test001", "éšè—1")
          tempDateSelections.clear();
        }

        document.addEventListener('click', closeDateFilterDropdown);
      });

      dateFilterDropdown.addEventListener('click', (e) => {
        console.log("test001", "åˆ—è¡¨1")
        e.stopPropagation();
      });

      dateFilterApply.addEventListener('click', () => {
        console.log("test001", "ç¡®å®š1")
        dateFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        dateFilterSelections = new Set(tempDateSelections);
        applyCombinedFilter();
        dateFilterDropdown.classList.remove('show');
        updateFilterActiveIndicator();
        tempDateSelections.clear();
      });

      dateFilterCancel.addEventListener('click', () => {
        console.log("test001", "å–æ¶ˆ1")
        dateFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        tempDateSelections.clear();
        dateFilterDropdown.classList.remove('show');
      });
    }

    // åˆå§‹åŒ–Typeç­›é€‰åŠŸèƒ½
    function initTypeFilter() {
      console.log("test001", "402")
      typeFilterHeader.addEventListener('click', (e) => {
        console.log("test001", "é¡¶éƒ¨æŒ‰é’®2")
        e.stopPropagation();
        closeDateFilterDropdown();
        closeTagFilterDropdown();
        const isShow = typeFilterDropdown.classList.toggle('show');

        if (isShow) {
          console.log("test001", "æ˜¾ç¤º2")
          tempTypeSelections = new Set(typeFilterSelections);
          renderTypeFilterItems();
          updateTypeFilterCounts();
          updateApplyButtonStatus('type');
          dateFilterDropdown.style.zIndex = 10;
          typeFilterDropdown.style.zIndex = 30;
          tagFilterDropdown.style.zIndex = 10;
        } else {
          console.log("test001", "éšè—2")
          tempTypeSelections.clear();
        }

        document.addEventListener('click', closeTypeFilterDropdown);
      });

      typeFilterDropdown.addEventListener('click', (e) => {
        console.log("test001", "åˆ—è¡¨2")
        e.stopPropagation();
      });

      typeFilterApply.addEventListener('click', () => {
        console.log("test001", "ç¡®å®š2")
        typeFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        typeFilterSelections = new Set(tempTypeSelections);
        applyCombinedFilter();
        typeFilterDropdown.classList.remove('show');
        updateFilterActiveIndicator();
        tempTypeSelections.clear();
      });

      typeFilterCancel.addEventListener('click', () => {
        console.log("test001", "å–æ¶ˆ2")
        typeFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        tempTypeSelections.clear();
        typeFilterDropdown.classList.remove('show');
      });
    }

    // åˆå§‹åŒ–Tagç­›é€‰åŠŸèƒ½
    function initTagFilter() {
      console.log("test001", "403")
      tagFilterHeader.addEventListener('click', (e) => {
        console.log("test001", "é¡¶éƒ¨æŒ‰é’®3")
        e.stopPropagation();
        closeDateFilterDropdown();
        closeTypeFilterDropdown();
        const isShow = tagFilterDropdown.classList.toggle('show');

        if (isShow) {
          console.log("test001", "æ˜¾ç¤º3")
          tempTagSelections = new Set(tagFilterSelections);
          renderTagFilterItems();
          updateTagFilterCounts();
          updateApplyButtonStatus('tag');
          dateFilterDropdown.style.zIndex = 10;
          typeFilterDropdown.style.zIndex = 10;
          tagFilterDropdown.style.zIndex = 30;
        } else {
          console.log("test001", "éšè—3")
          tempTagSelections.clear();
        }

        document.addEventListener('click', closeTagFilterDropdown);
      });

      tagFilterDropdown.addEventListener('click', (e) => {
        console.log("test001", "åˆ—è¡¨3")
        e.stopPropagation();
      });

      tagFilterApply.addEventListener('click', () => {
        console.log("test001", "ç¡®å®š3")
        tagFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        tagFilterSelections = new Set(tempTagSelections);
        applyCombinedFilter();
        tagFilterDropdown.classList.remove('show');
        updateFilterActiveIndicator();
        tempTagSelections.clear();
      });

      tagFilterCancel.addEventListener('click', () => {
        console.log("test001", "å–æ¶ˆ3")
        tagFilterDropdown.style.zIndex = 10;
        logContainer.style.zIndex = 20;
        tempTagSelections.clear();
        tagFilterDropdown.classList.remove('show');
      });
    }

    // æ›´æ–°ç¡®å®šæŒ‰é’®çŠ¶æ€
    function updateApplyButtonStatus(filterType) {
      console.log("test001", "900 filterType = " + filterType)
      if (filterType === 'date') {
        const isDisabled = tempDateSelections.size === 0;
        dateFilterApply.disabled = isDisabled;
        dateFilterApply.className = isDisabled
          ? 'filter-btn filter-btn-disabled'
          : 'filter-btn bg-primary hover:bg-primary/80';
      } else if (filterType === 'type') {
        const isDisabled = tempTypeSelections.size === 0;
        typeFilterApply.disabled = isDisabled;
        typeFilterApply.className = isDisabled
          ? 'filter-btn filter-btn-disabled'
          : 'filter-btn bg-primary hover:bg-primary/80';
      } else if (filterType === 'tag') {
        const isDisabled = tempTagSelections.size === 0;
        tagFilterApply.disabled = isDisabled;
        tagFilterApply.className = isDisabled
          ? 'filter-btn filter-btn-disabled'
          : 'filter-btn bg-primary hover:bg-primary/80';
      }
    }

    // å…³é—­Typeç­›é€‰ä¸‹æ‹‰èœå•
    function closeDateFilterDropdown() {
      console.log("test001", "501")
      dateFilterDropdown.style.zIndex = 10;
      logContainer.style.zIndex = 20;
      if (dateFilterDropdown.classList.contains('show')) {
        tempDateSelections.clear();
        dateFilterDropdown.classList.remove('show');
      }
      document.removeEventListener('click', closeDateFilterDropdown);
    }

    // å…³é—­Typeç­›é€‰ä¸‹æ‹‰èœå•
    function closeTypeFilterDropdown() {
      console.log("test001", "502")
      typeFilterDropdown.style.zIndex = 10;
      logContainer.style.zIndex = 20;
      if (typeFilterDropdown.classList.contains('show')) {
        tempTypeSelections.clear();
        typeFilterDropdown.classList.remove('show');
      }
      document.removeEventListener('click', closeTypeFilterDropdown);

    }

    // å…³é—­Tagç­›é€‰ä¸‹æ‹‰èœå•
    function closeTagFilterDropdown() {
      console.log("test001", "503")
      tagFilterDropdown.style.zIndex = 10;
      logContainer.style.zIndex = 20;
      if (tagFilterDropdown.classList.contains('show')) {
        tempTagSelections.clear();
        tagFilterDropdown.classList.remove('show');
      }
      document.removeEventListener('click', closeTagFilterDropdown);
    }

    // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰ç­›é€‰èœå•
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.filter-header') && !e.target.closest('.filter-dropdown')) {
        closeDateFilterDropdown();
        closeTypeFilterDropdown();
        closeTagFilterDropdown();
      }
    });

    // æ”¶é›†ç­›é€‰æ•°æ®
    function collectAllFiltersData() {
      console.log("test001", "100")
      allDates.clear();
      allTypes.clear();
      allTags.clear();

      logData.forEach(log => {
        if (log.date) {
          allDates.add(log.date.trim());
        }
        if (log.type) {
          allTypes.add(log.type.trim());
        }
        if (log.tag) {
          allTags.add(log.tag.trim());
        }
      });
      dateFilterSelections = new Set(allDates);
      typeFilterSelections = new Set(allTypes);
      tagFilterSelections = new Set(allTags);
      tempDateSelections = new Set(dateFilterSelections);
      tempTypeSelections = new Set(typeFilterSelections);
      tempTagSelections = new Set(tagFilterSelections);

      renderDateFilterItems();
      renderTypeFilterItems();
      renderTagFilterItems();

      updateApplyButtonStatus('date');
      updateApplyButtonStatus('type');
      updateApplyButtonStatus('tag');
    }

    function renderDateFilterItems() {
      console.log("test001", "101")
      dateFilterItems.innerHTML = '';

      const sortedDates = Array.from(allDates).sort((a, b) => a.localeCompare(b));

      // æ·»åŠ å…¨é€‰æ¡†ï¼ˆå¸¦æ•°é‡ç»Ÿè®¡ï¼Œå›ºå®šé¡¶éƒ¨ï¼‰
      const allSelectItem = createAllSelectItem('date');
      dateFilterItems.appendChild(allSelectItem);

      // æ·»åŠ æ™®é€šç­›é€‰é¡¹
      sortedDates.forEach(date => {
        const filterItem = document.createElement('div');
        filterItem.className = 'filter-item';
        filterItem.dataset.date = date;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'filter-checkbox mr-3';
        checkbox.id = `date-filter-${date}`;
        checkbox.value = date;
        checkbox.checked = tempDateSelections.has(date);

        // å¤é€‰æ¡†å˜æ›´äº‹ä»¶ï¼ˆæ ¸å¿ƒï¼šä¸é˜»æ­¢å†’æ³¡ï¼Œç›´æ¥å¤„ç†çŠ¶æ€ï¼‰
        checkbox.addEventListener('change', () => {
          if (checkbox.checked) {
            tempDateSelections.add(date);
          } else {
            tempDateSelections.delete(date);
          }
          syncAllSelectStatus('date');
          updateApplyButtonStatus('date');
          updateDateFilterCounts();
        });

        const label = document.createElement('label');
        label.htmlFor = `date-filter-${date}`;
        label.className = 'flex-1 cursor-pointer'; // ç¡®ä¿æ ‡ç­¾å¯ç‚¹å‡»
        label.textContent = date;

        const countSpan = document.createElement('span');
        countSpan.className = 'filter-count';
        countSpan.dataset.count = '0';
        countSpan.textContent = '0';

        filterItem.appendChild(checkbox);
        filterItem.appendChild(label);
        filterItem.appendChild(countSpan);
        dateFilterItems.appendChild(filterItem);

        filterItem.addEventListener('click', (e) => {
          if (e.target !== checkbox && e.target !== label && e.target !== countSpan) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });
      });

      updateDateFilterCounts();
      updateFilterActiveIndicator();
    }

    function renderTypeFilterItems() {
      console.log("test001", "102")
      typeFilterItems.innerHTML = '';

      const sortedTypes = Array.from(allTypes).sort((a, b) => a.localeCompare(b));

      // æ·»åŠ å…¨é€‰æ¡†ï¼ˆå¸¦æ•°é‡ç»Ÿè®¡ï¼Œå›ºå®šé¡¶éƒ¨ï¼‰
      const allSelectItem = createAllSelectItem('type');
      typeFilterItems.appendChild(allSelectItem);

      // æ·»åŠ æ™®é€šç­›é€‰é¡¹
      sortedTypes.forEach(type => {
        const filterItem = document.createElement('div');
        filterItem.className = 'filter-item';
        filterItem.dataset.type = type;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'filter-checkbox mr-3';
        checkbox.id = `type-filter-${type}`;
        checkbox.value = type;
        checkbox.checked = tempTypeSelections.has(type);

        // å¤é€‰æ¡†å˜æ›´äº‹ä»¶ï¼ˆæ ¸å¿ƒï¼šä¸é˜»æ­¢å†’æ³¡ï¼Œç›´æ¥å¤„ç†çŠ¶æ€ï¼‰
        checkbox.addEventListener('change', () => {
          if (checkbox.checked) {
            tempTypeSelections.add(type);
          } else {
            tempTypeSelections.delete(type);
          }
          syncAllSelectStatus('type');
          updateApplyButtonStatus('type');
          updateTypeFilterCounts();
        });

        const label = document.createElement('label');
        label.htmlFor = `type-filter-${type}`;
        label.className = 'flex-1 cursor-pointer'; // ç¡®ä¿æ ‡ç­¾å¯ç‚¹å‡»
        label.textContent = type;

        const countSpan = document.createElement('span');
        countSpan.className = 'filter-count';
        countSpan.dataset.count = '0';
        countSpan.textContent = '0';

        filterItem.appendChild(checkbox);
        filterItem.appendChild(label);
        filterItem.appendChild(countSpan);
        typeFilterItems.appendChild(filterItem);

        filterItem.addEventListener('click', (e) => {
          if (e.target !== checkbox && e.target !== label && e.target !== countSpan) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });
      });

      updateTypeFilterCounts();
      updateFilterActiveIndicator();
    }

    // æ¸²æŸ“Tagç­›é€‰é¡¹
    function renderTagFilterItems() {
      console.log("test001", "103")
      tagFilterItems.innerHTML = '';

      const sortedTags = Array.from(allTags).sort((a, b) => a.localeCompare(b));

      // æ·»åŠ å…¨é€‰æ¡†ï¼ˆå¸¦æ•°é‡ç»Ÿè®¡ï¼Œå›ºå®šé¡¶éƒ¨ï¼‰
      const allSelectItem = createAllSelectItem('tag');
      tagFilterItems.appendChild(allSelectItem);

      // æ·»åŠ æ™®é€šç­›é€‰é¡¹
      sortedTags.forEach(tag => {
        const filterItem = document.createElement('div');
        filterItem.className = 'filter-item';
        filterItem.dataset.tag = tag;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'filter-checkbox mr-3';
        checkbox.id = `tag-filter-${tag}`;
        checkbox.value = tag;
        checkbox.checked = tempTagSelections.has(tag);

        checkbox.addEventListener('change', () => {
          if (checkbox.checked) {
            tempTagSelections.add(tag);
          } else {
            tempTagSelections.delete(tag);
          }
          syncAllSelectStatus('tag');
          updateApplyButtonStatus('tag');
          updateTagFilterCounts();
        });

        const label = document.createElement('label');
        label.htmlFor = `tag-filter-${tag}`;
        label.className = 'flex-1 cursor-pointer';
        label.textContent = tag;

        const countSpan = document.createElement('span');
        countSpan.className = 'filter-count';
        countSpan.dataset.count = '0';
        countSpan.textContent = '0';

        filterItem.appendChild(checkbox);
        filterItem.appendChild(label);
        filterItem.appendChild(countSpan);
        tagFilterItems.appendChild(filterItem);

        filterItem.addEventListener('click', (e) => {
          if (e.target !== checkbox && e.target !== label && e.target !== countSpan) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });
      });

      updateTagFilterCounts();
      updateFilterActiveIndicator();
    }

    function createAllSelectItem(filterType) {
      console.log("test001", "400 filterType = " + filterType)
      const allItem = document.createElement('div');
      allItem.className = 'filter-item filter-all-item';
      allItem.dataset.filter = filterType;

      const allCheckbox = document.createElement('input');
      allCheckbox.type = 'checkbox';
      allCheckbox.className = 'filter-checkbox mr-3';
      allCheckbox.id = `${filterType}-filter-all`;
      allCheckbox.value = 'all';

      // åŸºäºä¸´æ—¶é›†åˆè®¾ç½®å…¨é€‰æ¡†åˆå§‹çŠ¶æ€
      if (filterType === 'date') {
        allCheckbox.checked = tempDateSelections.size === allDates.size && allDates.size > 0;
      } else if (filterType === 'type') {
        allCheckbox.checked = tempTypeSelections.size === allTypes.size && allTypes.size > 0;
      } else {
        allCheckbox.checked = tempTagSelections.size === allTags.size && allTags.size > 0;
      }

      // å…¨é€‰æ¡†å˜æ›´äº‹ä»¶
      allCheckbox.addEventListener('change', () => {
        const isChecked = allCheckbox.checked;
        if (filterType === 'date') {
          tempDateSelections.clear();
          if (isChecked) {
            allDates.forEach(date => tempDateSelections.add(date));
          }
          // æ›´æ–°æ‰€æœ‰å­å¤é€‰æ¡†çŠ¶æ€
          document.querySelectorAll('#date-filter-items .filter-item[data-date] input').forEach(checkbox => {
            checkbox.checked = isChecked;
          });
        } else if (filterType === 'type') {
          tempTypeSelections.clear();
          if (isChecked) {
            allTypes.forEach(type => tempTypeSelections.add(type));
          }
          // æ›´æ–°æ‰€æœ‰å­å¤é€‰æ¡†çŠ¶æ€
          document.querySelectorAll('#type-filter-items .filter-item[data-type] input').forEach(checkbox => {
            checkbox.checked = isChecked;
          });
        } else {
          tempTagSelections.clear();
          if (isChecked) {
            allTags.forEach(tag => tempTagSelections.add(tag));
          }
          document.querySelectorAll('#tag-filter-items .filter-item[data-tag] input').forEach(checkbox => {
            checkbox.checked = isChecked;
          });
        }

        updateApplyButtonStatus(filterType);
        updateFilterCounts(filterType);
        updateFilterActiveIndicator();
      });

      const allLabel = document.createElement('label');
      allLabel.htmlFor = `${filterType}-filter-all`;
      allLabel.className = 'flex-1 cursor-pointer';
      allLabel.textContent = 'å…¨é€‰';

      const allCountSpan = document.createElement('span');
      allCountSpan.className = 'filter-count';
      allCountSpan.dataset.count = '0';
      allCountSpan.textContent = '0';

      allItem.appendChild(allCheckbox);
      allItem.appendChild(allLabel);
      allItem.appendChild(allCountSpan);

      // ç‚¹å‡»æ•´è¡Œè§¦å‘å…¨é€‰æ¡†å˜æ›´
      allItem.addEventListener('click', (e) => {
        if (e.target !== allCheckbox && e.target !== allLabel && e.target !== allCountSpan) {
          allCheckbox.checked = !allCheckbox.checked;
          allCheckbox.dispatchEvent(new Event('change'));
        }
      });

      return allItem;
    }

    // åŒæ­¥å…¨é€‰æ¡†çŠ¶æ€
    function syncAllSelectStatus(filterType) {
      console.log("test001", "200 filterType = " + filterType)
      const allCheckbox = document.getElementById(`${filterType}-filter-all`);
      if (!allCheckbox) return;

      if (filterType === 'date') {
        const isAllSelected = tempDateSelections.size === allDates.size && allDates.size > 0;
        allCheckbox.checked = isAllSelected;
      }
      else if (filterType === 'type') {
        const isAllSelected = tempTypeSelections.size === allTypes.size && allTypes.size > 0;
        allCheckbox.checked = isAllSelected;
      } else {
        const isAllSelected = tempTagSelections.size === allTags.size && allTags.size > 0;
        allCheckbox.checked = isAllSelected;
      }
    }

    // é€šç”¨æ–¹æ³•ï¼šæ›´æ–°ç­›é€‰è®¡æ•°
    function updateFilterCounts(filterType) {
      console.log("test001", "600 filterType = " + filterType)
      if (filterType === 'date') {
        updateDateFilterCounts();
      } else if (filterType === 'type') {
        updateTypeFilterCounts();
      } else {
        updateTagFilterCounts();
      }
    }

    // æ›´æ–°Dateç­›é€‰èœå•ä¸­æ‰€æœ‰é€‰é¡¹çš„æ•°é‡ç»Ÿè®¡ï¼ˆåŒ…å«å…¨é€‰æŒ‰é’®ï¼‰
    function updateDateFilterCounts() {
      console.log("test001", "201")
      // 1. æ›´æ–°æ™®é€šé€‰é¡¹æ•°é‡
      document.querySelectorAll('#date-filter-items .filter-item[data-date]').forEach(item => {
        const date = item.dataset.date;
        const countSpan = item.querySelector('.filter-count');

        const count = logData.filter(log => {
          const dateMatch = log.date.trim() === date;
          const typeMatch = typeFilterSelections.size === 0 || typeFilterSelections.has(log.type.trim());
          const tagMatch = tagFilterSelections.size === 0 || tagFilterSelections.has(log.tag.trim());
          return dateMatch && typeMatch && tagMatch;
        }).length;

        countSpan.dataset.count = count;
        countSpan.textContent = count;

        if (count === 0) {
          item.classList.add('opacity-50');
          item.querySelector('input').disabled = true;
        } else {
          item.classList.remove('opacity-50');
          item.querySelector('input').disabled = false;
        }
      });

      // æ›´æ–°å…¨é€‰æŒ‰é’®çš„æ•°é‡ç»Ÿè®¡ï¼ˆé€‰ä¸­é¡¹çš„æ€»æ—¥å¿—æ•°ï¼‰
      const allSelectItem = document.querySelector('#date-filter-items .filter-all-item');
      const allCountSpan = allSelectItem.querySelector('.filter-count');

      // è®¡ç®—æ‰€æœ‰é€‰ä¸­Dateçš„æ—¥å¿—æ€»æ•°ï¼ˆè€ƒè™‘å½“å‰Tagç­›é€‰æ¡ä»¶ï¼‰
      let totalCount = 0;
      tempDateSelections.forEach(date => {
        const dateCount = logData.filter(log => {
          const dateMatch = log.date.trim() === date;
          const typeMatch = typeFilterSelections.size === 0 || typeFilterSelections.has(log.type.trim());
          const tagMatch = tagFilterSelections.size === 0 || tagFilterSelections.has(log.tag.trim());
          return dateMatch && typeMatch && tagMatch;
        }).length;
        totalCount += dateCount;
      });

      allCountSpan.dataset.count = totalCount;
      allCountSpan.textContent = totalCount;
    }

    // æ›´æ–°Typeç­›é€‰èœå•ä¸­æ‰€æœ‰é€‰é¡¹çš„æ•°é‡ç»Ÿè®¡ï¼ˆåŒ…å«å…¨é€‰æŒ‰é’®ï¼‰
    function updateTypeFilterCounts() {
      console.log("test001", "202")
      // 1. æ›´æ–°æ™®é€šé€‰é¡¹æ•°é‡
      document.querySelectorAll('#type-filter-items .filter-item[data-type]').forEach(item => {
        const type = item.dataset.type;
        const countSpan = item.querySelector('.filter-count');

        const count = logData.filter(log => {
          const typeMatch = log.type.trim() === type;
          const dateMatch = dateFilterSelections.size === 0 || dateFilterSelections.has(log.date.trim());
          const tagMatch = tagFilterSelections.size === 0 || tagFilterSelections.has(log.tag.trim());
          return typeMatch && dateMatch && tagMatch;
        }).length;

        countSpan.dataset.count = count;
        countSpan.textContent = count;

        if (count === 0) {
          item.classList.add('opacity-50');
          item.querySelector('input').disabled = true;
        } else {
          item.classList.remove('opacity-50');
          item.querySelector('input').disabled = false;
        }
      });

      // æ›´æ–°å…¨é€‰æŒ‰é’®çš„æ•°é‡ç»Ÿè®¡ï¼ˆé€‰ä¸­é¡¹çš„æ€»æ—¥å¿—æ•°ï¼‰
      const allSelectItem = document.querySelector('#type-filter-items .filter-all-item');
      const allCountSpan = allSelectItem.querySelector('.filter-count');

      // è®¡ç®—æ‰€æœ‰é€‰ä¸­Typeçš„æ—¥å¿—æ€»æ•°ï¼ˆè€ƒè™‘å½“å‰Tagç­›é€‰æ¡ä»¶ï¼‰
      let totalCount = 0;
      tempTypeSelections.forEach(type => {
        const typeCount = logData.filter(log => {
          const typeMatch = log.type.trim() === type;
          const dateMatch = dateFilterSelections.size === 0 || dateFilterSelections.has(log.date.trim());
          const tagMatch = tagFilterSelections.size === 0 || tagFilterSelections.has(log.tag.trim());
          return typeMatch && dateMatch && tagMatch;
        }).length;
        totalCount += typeCount;
      });

      allCountSpan.dataset.count = totalCount;
      allCountSpan.textContent = totalCount;
    }

    // æ›´æ–°Tagç­›é€‰èœå•ä¸­æ‰€æœ‰é€‰é¡¹çš„æ•°é‡ç»Ÿè®¡ï¼ˆåŒ…å«å…¨é€‰æŒ‰é’®ï¼‰
    function updateTagFilterCounts() {
      console.log("test001", "203")
      // 1. æ›´æ–°æ™®é€šé€‰é¡¹æ•°é‡
      document.querySelectorAll('#tag-filter-items .filter-item[data-tag]').forEach(item => {
        const tag = item.dataset.tag;
        const countSpan = item.querySelector('.filter-count');

        const count = logData.filter(log => {
          const tagMatch = log.tag.trim() === tag;
          const dateMatch = dateFilterSelections.size === 0 || dateFilterSelections.has(log.date.trim());
          const typeMatch = typeFilterSelections.size === 0 || typeFilterSelections.has(log.type.trim());
          return tagMatch && dateMatch && typeMatch;
        }).length;

        countSpan.dataset.count = count;
        countSpan.textContent = count;

        if (count === 0) {
          item.classList.add('opacity-50');
          item.querySelector('input').disabled = true;
        } else {
          item.classList.remove('opacity-50');
          item.querySelector('input').disabled = false;
        }
      });

      // æ›´æ–°å…¨é€‰æŒ‰é’®çš„æ•°é‡ç»Ÿè®¡ï¼ˆé€‰ä¸­é¡¹çš„æ€»æ—¥å¿—æ•°ï¼‰
      const allSelectItem = document.querySelector('#tag-filter-items .filter-all-item');
      const allCountSpan = allSelectItem.querySelector('.filter-count');

      // è®¡ç®—æ‰€æœ‰é€‰ä¸­Tagçš„æ—¥å¿—æ€»æ•°ï¼ˆè€ƒè™‘å½“å‰Typeç­›é€‰æ¡ä»¶ï¼‰
      let totalCount = 0;
      tempTagSelections.forEach(tag => {
        const tagCount = logData.filter(log => {
          const tagMatch = log.tag.trim() === tag;
          const dateMatch = dateFilterSelections.size === 0 || dateFilterSelections.has(log.date.trim());
          const typeMatch = typeFilterSelections.size === 0 || typeFilterSelections.has(log.type.trim());
          return tagMatch && dateMatch && typeMatch;
        }).length;
        totalCount += tagCount;
      });

      allCountSpan.dataset.count = totalCount;
      allCountSpan.textContent = totalCount;
    }

    // æ›´æ–°ç­›é€‰æ¿€æ´»çŠ¶æ€æŒ‡ç¤ºå™¨
    function updateFilterActiveIndicator() {
      console.log("test001", "700")

      const isDateFilterActive = dateFilterSelections.size > 0 && dateFilterSelections.size < allDates.size;
      dateFilterActive.classList.toggle('hidden', !isDateFilterActive);
      dateFilterHeader.classList.toggle('filter-header-active', isDateFilterActive);

      const isTypeFilterActive = typeFilterSelections.size > 0 && typeFilterSelections.size < allTypes.size;
      typeFilterActive.classList.toggle('hidden', !isTypeFilterActive);
      typeFilterHeader.classList.toggle('filter-header-active', isTypeFilterActive);

      const isTagFilterActive = tagFilterSelections.size > 0 && tagFilterSelections.size < allTags.size;
      tagFilterActive.classList.toggle('hidden', !isTagFilterActive);
      tagFilterHeader.classList.toggle('filter-header-active', isTagFilterActive);
    }

    // æ ¸å¿ƒç­›é€‰é€»è¾‘
    function applyCombinedFilter() {
      console.log("test001", "800")
      filteredLogData = [];

      const isDateEmpty = dateFilterSelections.size === 0;
      const isDateFull = dateFilterSelections.size === allDates.size;

      const isTypeEmpty = typeFilterSelections.size === 0;
      const isTypeFull = typeFilterSelections.size === allTypes.size;

      const isTagEmpty = tagFilterSelections.size === 0;
      const isTagFull = tagFilterSelections.size === allTags.size;

      console.log("test001", "801 isDateEmpty = " + isDateEmpty + " isTypeEmpty = " + isTypeEmpty + " isTagEmpty =" + isTagEmpty)

      if (isDateEmpty && isTypeEmpty && isTagEmpty) {
        console.log("test001", "802")
        filteredLogData = [...logData];
      } else if (isDateEmpty) {
        console.log("test001", "803")
        filteredLogData = logData.filter(log =>
          isTypeFull ? true : typeFilterSelections.has(log.type.trim()) && isTagFull ? true : tagFilterSelections.has(log.tag.trim())
        );

      } else if (isTypeEmpty) {
        console.log("test001", "804")
        filteredLogData = logData.filter(log =>
          isDateFull ? true : dateFilterSelections.has(log.date.trim()) && tagFilterSelections.has(log.tag.trim())
        );

      } else if (isTagEmpty) {
        console.log("test001", "805")
        filteredLogData = logData.filter(log =>
          isDateFull ? true : dateFilterSelections.has(log.date.trim()) && typeFilterSelections.has(log.type.trim())
        );

      } else {
        console.log("test001", "806")
        filteredLogData = logData.filter(log => {
          const datePass = isDateFull ? true : dateFilterSelections.has(log.date.trim());
          const typePass = isTypeFull ? true : typeFilterSelections.has(log.type.trim());
          const tagPass = isTagFull ? true : tagFilterSelections.has(log.tag.trim());
          return datePass && typePass && tagPass;
        });
      }

      renderLogs();
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) {
        alert('Please select a file');
        setDateout(() => fileInput.click(), 100);
        return;
      }

      if (file.type !== 'text/plain' && !file.name.endsWith('.zh')) {
        alert('Please select the correct file format (.zh)');
        setDateout(() => fileInput.click(), 100);
        return;
      }

      const reader = new FileReader();

      reader.onload = function (e) {
        try {
          inputData = e.target.result
          logData = getData();
          collectAllFiltersData();
          applyCombinedFilter();
          initJsonCollapsibles();
        } catch (error) {
          console.error('æ–‡ä»¶å¤„ç†é”™è¯¯:', error);
          alert('File read failed : ' + error.message);
          setDateout(() => fileInput.click(), 100);
        }
      };

      reader.onerror = function () {
        alert('æ–‡ä»¶è¯»å–é”™è¯¯');
        setDateout(() => fileInput.click(), 100);
      };

      reader.readAsText(file);
    }

    function getData() {
      const lines = inputData.split(/\r?\n/);
      let resultData = [];

      lines.forEach((line, index) => {
        for (let i = 0; i < 20; i++) {
          if (line.includes("---->")) {
            line = line.replace('---->', '--->')
          } else {
            break
          }
        }

        let detailed = ""
        if (line.includes('--->')) {
          const arr01 = line.split(' ---> ')

          if (arr01.length >= 4) {
            let data = arr01[3]
              .replace("<BIND>  ", "")
              .replace("<CONNECT>  ", "")
              .replace("<DAILY>  ", "")
              .replace("<SPORT>  ", "")
              .replace("<BASIC>  ", "")
              .replace("<NOTIFICATION>  ", "")
              .replace("<DIAL>  ", "")
              .replace("<OTA>  ", "")
              .replace("<APGS>  ", "")
              .replace("<SET>  ", "")
              .replace("<AUXILIARYET>  ", "")

            let isDetailed = false
            for (let i = index + 1; i < lines.length; i++) {
              if (lines[i] == "") {
                isDetailed = true
                break
              }
              else if (lines[i].includes("---->")) {
                break
              }
              detailed += lines[i] + "\n";
            }

            if (isDetailed) {
              let allData = data
              if (detailed != "") {
                allData += "\n" + detailed.trimEnd()
              }

              if (allData.includes(" = ")) {
                const arr02 = allData.split(' = ')
                data = arr02[0]
                detailed = arr02[1]
              }
            }

            const arr02 = arr01[0].split(' ')

            const logEntry = {
              id: index + 1,
              line: index + 1,
              date: arr01[0].split(' ')[0],
              time: arr01[0].split(' ')[1],
              tag: arr01[1],
              type: arr01[2],
              data: data,
              detailed: detailed,
              hasJson: detailed ? true : false
            }

            resultData.push(logEntry);
          }
        }
      });

      return resultData;
    }

    function createJsonToggleButton() {
      const toggleBtn = document.createElement('span');
      toggleBtn.className = 'json-toggle';
      toggleBtn.textContent = 'Show';
      return toggleBtn;
    }

    // æ¸²æŸ“JSONè§†å›¾
    function renderJsonView(jsonData) {
      try {
        const jsonStr = JSON.stringify(jsonData, null, 2);

        const jsonContainer = document.createElement('div');
        jsonContainer.className = 'json-container';

        const pre = document.createElement('pre');
        const code = document.createElement('code');
        code.className = 'language-json json-line';
        code.textContent = jsonStr;

        pre.appendChild(code);
        jsonContainer.appendChild(pre);

        Prism.highlightElement(code);

        return jsonContainer;
      } catch (error) {
        const errorContainer = document.createElement('div');
        errorContainer.className = 'json-container text-warning';
        errorContainer.innerHTML = `<pre>JSONè§£æå¤±è´¥: ${error.message}\n\nåŸå§‹æ•°æ®:\n${jsonData}</pre>`;
        return errorContainer;
      }
    }

    // æ¸²æŸ“æ—¥å¿—è¡Œ
    function renderLogRow(log) {
      const logRow = document.createElement('div');
      const rowClasses = `grid grid-cols-[30px_95px_120px_220px_20px_1fr] items-center py-1 px-3 rounded-md log-row-hover group transition-all`;
      logRow.className = rowClasses;
      logRow.dataset.id = log.id;
      logRow.dataset.line = log.line;

      // è¡Œæ•°åˆ—
      const lineCol = document.createElement('div');
      lineCol.className = 'text-dark-400 pr-4';
      lineCol.textContent = log.line;

      // æ—¥æœŸåˆ—
      const dateCol = document.createElement('div');
      dateCol.className = 'text-dark-300 pr-4';
      dateCol.textContent = log.date;

      // æ—¶é—´åˆ—
      const timeCol = document.createElement('div');
      timeCol.className = 'text-dark-300 pr-4';
      timeCol.textContent = log.time;

      // ç±»å‹åˆ—
      const typeCol = document.createElement('div');
      typeCol.className = 'text-dark-300 pr-4';
      typeCol.textContent = log.type;

      // æ ‡è®°åˆ— 
      const tagCol = document.createElement('div');
      tagCol.className = 'text-dark-100 pr-4 px-2 py-1 font-medium rounded';
      tagCol.textContent = log.tag;

      // æ•°æ®åˆ—
      const dataCol = document.createElement('div');
      dataCol.className = 'break-all pl-4';

      // æ ¹æ®tagå€¼è®¾ç½®é¢œè‰²
      switch (log.tag) {
        case 'I':
          tagCol.classList.add('bg-blue-500/20', 'text-blue-400', 'border', 'border-blue-500/30');
          dataCol.classList.add('text-blue-400');
          break;
        case 'W':
          tagCol.classList.add('bg-orange-500/20', 'text-orange-400', 'border', 'border-orange-500/30');
          dataCol.classList.add('text-orange-400');
          break;
        case 'E':
          tagCol.classList.add('bg-red-500/20', 'text-red-400', 'border', 'border-red-500/30');
          dataCol.classList.add('text-red-400');
          break;
        case 'D':
          tagCol.classList.add('bg-gray-400', 'text-gray-300', 'border', 'border-gray-200');
          dataCol.classList.add('text-gray-300');
          break;
        case 'V':
          tagCol.classList.add('bg-purple-500/20', 'text-purple-400', 'border', 'border-purple-500/30');
          dataCol.classList.add('text-purple-400');
          break;
        default:
          tagCol.classList.add('bg-gray-500/20', 'text-gray-400', 'border', 'border-gray-500/30');
          dataCol.classList.add('text-gray-400');
      }

      // æ·»åŠ ä¸»æ•°æ®
      const mainData = document.createElement('div');
      mainData.className = 'whitespace-pre-wrap';
      mainData.textContent = log.data;
      dataCol.appendChild(mainData);

      // å¦‚æœæœ‰JSONæ•°æ®ï¼Œæ·»åŠ æŠ˜å /å±•å¼€åŠŸèƒ½
      if (log.hasJson && log.detailed) {
        const toggleBtn = createJsonToggleButton();
        const jsonContent = renderJsonView(protoTextToJson(log.detailed));
        jsonContent.classList.add('json-collapsible');

        const toggleContainer = document.createElement('div');
        toggleContainer.className = 'mt-1';
        toggleContainer.appendChild(toggleBtn);
        dataCol.appendChild(toggleContainer);
        dataCol.appendChild(jsonContent);

        toggleBtn.addEventListener('click', () => {
          jsonContent.classList.toggle('expanded');
          toggleBtn.textContent = jsonContent.classList.contains('expanded') ? 'Hide' : 'Show';
        });
      }

      // ç»„è£…æ—¥å¿—è¡Œ
      logRow.appendChild(lineCol);
      logRow.appendChild(dateCol);
      logRow.appendChild(timeCol);
      logRow.appendChild(typeCol);
      logRow.appendChild(tagCol);
      logRow.appendChild(dataCol);

      // ç‚¹å‡»æ•´è¡Œå±•å¼€/æŠ˜å JSON
      logRow.addEventListener('click', (e) => {
        if (!e.target.closest('.json-toggle')) {
          const jsonCollapsible = logRow.querySelector('.json-collapsible');
          const toggleBtn = logRow.querySelector('.json-toggle');
          if (jsonCollapsible && toggleBtn) {
            jsonCollapsible.classList.toggle('expanded');
            toggleBtn.textContent = jsonCollapsible.classList.contains('expanded') ? 'Hide' : 'Show';
          }
        }
      });

      return logRow;
    }

    // åˆå§‹åŒ–æ‰€æœ‰JSONæŠ˜å åŠŸèƒ½
    function initJsonCollapsibles() {
      document.querySelectorAll('code.language-json').forEach(block => {
        Prism.highlightElement(block);
      });
    }

    function protoTextToJson(protoText) {
      const lines = protoText.trim().split('\n').map(line => line.trim());
      const stack = [{}];
      let currentObj = stack[0];

      for (const line of lines) {
        if (!line) continue;

        if (line.endsWith('{')) {
          const key = line.replace(/\s*{$/, '').trim();
          const childObj = {};
          currentObj[key] = childObj;
          stack.push(childObj);
          currentObj = childObj;
        } else if (line === '}') {
          stack.pop();
          currentObj = stack[stack.length - 1];
        } else {
          const match = line.match(/^([^:]+):\s*(.*)$/);
          if (match) {
            const key = match[1].trim();
            let value = match[2].trim();

            if (value.startsWith('"') && value.endsWith('"')) {
              value = value.slice(1, -1);
            } else if (!isNaN(Number(value))) {
              value = Number(value);
            }

            currentObj[key] = value;
          }
        }
      }

      return stack[0];
    }

    // æ¸²æŸ“æ—¥å¿—åˆ—è¡¨
    function renderLogs() {
      console.log("test001", "400")
      logContainer.innerHTML = '';

      if (filteredLogData.length === 0) {
        const filterInfo = [];
        if (dateFilterSelections.size > 0 && dateFilterSelections.size < allDates.size) {
          filterInfo.push(`Date: ${Array.from(dateFilterSelections).join(', ')}`);
        }
        if (typeFilterSelections.size > 0 && typeFilterSelections.size < allTypes.size) {
          filterInfo.push(`Type: ${Array.from(typeFilterSelections).join(', ')}`);
        }
        if (tagFilterSelections.size > 0 && tagFilterSelections.size < allTags.size) {
          filterInfo.push(`Tag: ${Array.from(tagFilterSelections).join(', ')}`);
        }

        const emptyState = document.createElement('div');
        emptyState.className = 'flex flex-col items-center justify-center h-full text-dark-400 p-4 text-center';
        emptyState.innerHTML = `
            <div class="mb-2">æ²¡æœ‰åŒ¹é…çš„æ—¥å¿—æ•°æ®</div>
            ${filterInfo.length > 0 ? `<div class="text-sm text-dark-500">å½“å‰ç­›é€‰æ¡ä»¶: ${filterInfo.join(' + ')}</div>` : ''}
          `;
        logContainer.appendChild(emptyState);
        return;
      }

      filteredLogData.forEach(log => {
        const logRow = renderLogRow(log);
        logContainer.appendChild(logRow);
      });
    }

    // åˆå§‹åŒ–é¡µé¢
    initFileSelection();
    initDateFilter();
    initTypeFilter();
    initTagFilter();
  </script>

</body>

</html>